{% extends 'base.html' %}

{% block title %}Sustainability Tips - GreenSteps{% endblock %}

{% block content %}
<div class="tips-container">
    <div class="tips-header">
        <h1>💡 Your Personalized Green Tips</h1>
        <p>Discover actionable ways to reduce your carbon footprint based on your activity patterns</p>
    </div>

    {% if top_categories %}
        <div class="insights-section">
            <h2>📊 Your Impact Insights</h2>
            <p class="insights-text">
                Based on your recent activities, your highest impact areas are:
                <strong>{{ top_categories|join:", " }}</strong>.
                Here are targeted tips to help you make a bigger difference:
            </p>
        </div>
    {% endif %}

    <div class="tips-grid">
        {% for tip in tips %}
            <div class="tip-card" data-category="{{ forloop.counter0|divisibleby:4 }}">
                <div class="tip-icon">
                    {% cycle '🌱' '♻️' '🚲' '💡' '🌍' '⚡' '🥗' '🚌' %}
                </div>
                <div class="tip-content">
                    <p class="tip-text">{{ tip }}</p>
                    <div class="tip-impact">
                        <span class="impact-badge">
                            {% cycle 'High Impact' 'Medium Impact' 'Easy Start' 'Daily Habit' 'High Impact' 'Medium Impact' 'Easy Start' 'Daily Habit' %}
                        </span>
                    </div>
                </div>
                <div class="tip-actions">
                    <button class="tip-btn done-btn" onclick="markTipDone(this)">
                        <span class="btn-icon">✅</span>
                        I'll try this
                    </button>
                    <button class="tip-btn share-btn" onclick="shareTip('{{ tip|escapejs }}')">
                        <span class="btn-icon">📤</span>
                        Share
                    </button>
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- General Categories Section -->
    <div class="categories-section">
        <h2>🔍 Explore More Tips by Category</h2>
        <div class="categories-grid">
            <div class="category-section transport">
                <div class="category-header">
                    <div class="category-icon">🚗</div>
                    <h3>Transportation</h3>
                    <p>Move more sustainably</p>
                </div>
                <ul class="category-tips">
                    <li>Walk or bike for short distances (under 2km)</li>
                    <li>Use public transport when available</li>
                    <li>Carpool for longer journeys</li>
                    <li>Consider electric or hybrid vehicles</li>
                    <li>Plan routes to combine multiple errands</li>
                    <li>Work from home when possible</li>
                </ul>
            </div>

            <div class="category-section energy">
                <div class="category-header">
                    <div class="category-icon">⚡</div>
                    <h3>Energy</h3>
                    <p>Power your home efficiently</p>
                </div>
                <ul class="category-tips">
                    <li>Switch to LED light bulbs</li>
                    <li>Unplug devices when not in use</li>
                    <li>Use programmable thermostats</li>
                    <li>Seal air leaks around windows and doors</li>
                    <li>Choose energy-efficient appliances</li>
                    <li>Consider renewable energy sources</li>
                </ul>
            </div>

            <div class="category-section food">
                <div class="category-header">
                    <div class="category-icon">🍽️</div>
                    <h3>Food</h3>
                    <p>Eat more sustainably</p>
                </div>
                <ul class="category-tips">
                    <li>Try "Meatless Monday" or reduce meat consumption</li>
                    <li>Buy local and seasonal produce</li>
                    <li>Reduce food waste with meal planning</li>
                    <li>Choose organic when possible</li>
                    <li>Grow your own herbs and vegetables</li>
                    <li>Compost food scraps</li>
                </ul>
            </div>

            <div class="category-section digital">
                <div class="category-header">
                    <div class="category-icon">💻</div>
                    <h3>Digital</h3>
                    <p>Reduce your digital footprint</p>
                </div>
                <ul class="category-tips">
                    <li>Stream videos in lower quality when possible</li>
                    <li>Delete unused apps and accounts</li>
                    <li>Use cloud storage efficiently</li>
                    <li>Choose dark mode to save device energy</li>
                    <li>Unsubscribe from unnecessary emails</li>
                    <li>Buy refurbished electronics when possible</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Progress Section -->
    <div class="progress-section">
        <div class="progress-card">
            <h3>🎯 Your Green Journey</h3>
            <p>Small actions lead to big changes. Every sustainable choice you make contributes to a healthier planet!</p>

            <div class="journey-stats">
                <div class="journey-stat">
                    <div class="stat-icon">📅</div>
                    <div class="stat-info">
                        <strong>Day {{ user.date_joined|timesince|slice:":2" }}{{ user.date_joined|timesince|slice:"3:4" }}</strong>
                        <small>of your green journey</small>
                    </div>
                </div>

                <div class="journey-stat">
                    <div class="stat-icon">🌱</div>
                    <div class="stat-info">
                        <strong>Making Progress</strong>
                        <small>Every activity tracked matters</small>
                    </div>
                </div>

                <div class="journey-stat">
                    <div class="stat-icon">🌍</div>
                    <div class="stat-info">
                        <strong>Global Impact</strong>
                        <small>Part of a growing movement</small>
                    </div>
                </div>
            </div>

            <div class="motivational-quote">
                <blockquote>
                    "The best time to plant a tree was 20 years ago. The second best time is now."
                    <cite>- Chinese Proverb</cite>
                </blockquote>
            </div>
        </div>
    </div>

    <!-- Call to Action -->
    <div class="cta-section">
        <div class="cta-content">
            <h2>Ready to Take Action?</h2>
            <p>Start implementing these tips today and track your progress</p>
            <div class="cta-actions">
                <a href="{% url 'add_activity' %}" class="btn btn-primary btn-lg">
                    📊 Log Today's Activities
                </a>
                <a href="{% url 'dashboard' %}" class="btn btn-secondary btn-lg">
                    📈 View My Progress
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function markTipDone(button) {
    const tipCard = button.closest('.tip-card');
    const tipText = tipCard.querySelector('.tip-text').textContent;

    // Visual feedback
    tipCard.classList.add('completed');
    button.innerHTML = '<span class="btn-icon">✅</span> Done!';
    button.disabled = true;

    // Store in localStorage (if available)
    try {
        const completedTips = JSON.parse(localStorage.getItem('completedTips') || '[]');
        if (!completedTips.includes(tipText)) {
            completedTips.push(tipText);
            localStorage.setItem('completedTips', JSON.stringify(completedTips));
        }
    } catch (e) {
        console.log('LocalStorage not available, but that\'s OK!');
    }

    // Show success message
    showMessage('Great! Keep up the good work! 🌱', 'success');
}

function shareTip(tipText) {
    if (navigator.share) {
        navigator.share({
            title: 'Green Tip from GreenSteps',
            text: `💡 Green Tip: ${tipText} - Track your carbon footprint with GreenSteps!`,
            url: window.location.origin
        });
    } else {
        // Fallback: copy to clipboard
        const textToCopy = `💡 Green Tip: ${tipText} - Track your carbon footprint with GreenSteps! ${window.location.origin}`;

        if (navigator.clipboard) {
            navigator.clipboard.writeText(textToCopy).then(() => {
                showMessage('Tip copied to clipboard! 📋', 'success');
            });
        } else {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showMessage('Tip copied to clipboard! 📋', 'success');
        }
    }
}

function showMessage(text, type) {
    const messagesContainer = document.querySelector('.messages-container') || createMessagesContainer();

    const message = document.createElement('div');
    message.className = `message message-${type}`;
    message.innerHTML = `
        <span class="message-text">${text}</span>
        <button class="message-close" onclick="this.parentElement.remove()">×</button>
    `;

    messagesContainer.appendChild(message);

    // Auto remove after 4 seconds
    setTimeout(() => {
        if (message.parentElement) {
            message.style.opacity = '0';
            setTimeout(() => message.remove(), 300);
        }
    }, 4000);
}

function createMessagesContainer() {
    const container = document.createElement('div');
    container.className = 'messages-container';
    document.body.appendChild(container);
    return container;
}

// Initialize completed tips on page load
document.addEventListener('DOMContentLoaded', function() {
    try {
        const completedTips = JSON.parse(localStorage.getItem('completedTips') || '[]');

        document.querySelectorAll('.tip-card').forEach(card => {
            const tipText = card.querySelector('.tip-text').textContent;
            if (completedTips.includes(tipText)) {
                const doneBtn = card.querySelector('.done-btn');
                card.classList.add('completed');
                doneBtn.innerHTML = '<span class="btn-icon">✅</span> Done!';
                doneBtn.disabled = true;
            }
        });
    } catch (e) {
        console.log('LocalStorage not available, starting fresh!');
    }

    // Add intersection observer for animations
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    });

    document.querySelectorAll('.tip-card, .category-section').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'all 0.6s ease';
        observer.observe(el);
    });
});
</script>

<style>
.tips-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: var(--space-6);
}

.tips-header {
    text-align: center;
    margin-bottom: var(--space-12);
}

.tips-header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: var(--space-4);
}

.tips-header p {
    font-size: 1.125rem;
    color: var(--gray-600);
    max-width: 600px;
    margin: 0 auto;
}

.insights-section {
    background: var(--emerald-50);
    border: 1px solid var(--emerald-200);
    border-radius: var(--radius-xl);
    padding: var(--space-6);
    margin-bottom: var(--space-12);
    border-left: 4px solid var(--emerald-500);
}

.insights-section h2 {
    font-size: 1.375rem;
    font-weight: 600;
    color: var(--emerald-800);
    margin-bottom: var(--space-3);
}

.insights-text {
    color: var(--emerald-700);
    line-height: 1.6;
}

.tips-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: var(--space-6);
    margin-bottom: var(--space-16);
}

.tip-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-2xl);
    padding: var(--space-6);
    box-shadow: var(--shadow-md);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.tip-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-xl);
}

.tip-card.completed {
    background: rgba(16, 185, 129, 0.05);
    border-color: var(--emerald-200);
}

.tip-card.completed::before {
    content: '✨';
    position: absolute;
    top: var(--space-4);
    right: var(--space-4);
    font-size: 1.25rem;
    opacity: 0.7;
}

.tip-icon {
    font-size: 2rem;
    margin-bottom: var(--space-4);
    text-align: center;
}

.tip-content {
    margin-bottom: var(--space-6);
}

.tip-text {
    font-size: 1rem;
    line-height: 1.6;
    color: var(--gray-800);
    margin-bottom: var(--space-4);
}

.tip-impact {
    display: flex;
    justify-content: center;
}

.impact-badge {
    padding: var(--space-1) var(--space-3);
    border-radius: var(--radius-md);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.tip-card:nth-child(4n+1) .impact-badge {
    background: rgba(16, 185, 129, 0.1);
    color: var(--emerald-600);
}

.tip-card:nth-child(4n+2) .impact-badge {
    background: rgba(59, 130, 246, 0.1);
    color: var(--blue-500);
}

.tip-card:nth-child(4n+3) .impact-badge {
    background: rgba(245, 158, 11, 0.1);
    color: var(--amber-500);
}

.tip-card:nth-child(4n+4) .impact-badge {
    background: rgba(139, 92, 246, 0.1);
    color: var(--purple-500);
}

.tip-actions {
    display: flex;
    gap: var(--space-3);
}

.tip-btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-3);
    border: 1px solid var(--gray-300);
    border-radius: var(--radius-md);
    background: white;
    color: var(--gray-700);
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}

.tip-btn:hover:not(:disabled) {
    background: var(--gray-50);
    border-color: var(--gray-400);
}

.done-btn:hover:not(:disabled) {
    background: var(--emerald-50);
    border-color: var(--emerald-300);
    color: var(--emerald-700);
}

.share-btn:hover {
    background: var(--blue-50);
    border-color: var(--blue-300);
    color: var(--blue-700);
}

.tip-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.categories-section {
    margin-bottom: var(--space-16);
}

.categories-section h2 {
    font-size: 2rem;
    font-weight: 600;
    color: var(--gray-900);
    text-align: center;
    margin-bottom: var(--space-8);
}

.categories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--space-8);
}

.category-section {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-2xl);
    padding: var(--space-8);
    box-shadow: var(--shadow-md);
    transition: all 0.3s ease;
}

.category-section:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
}

.category-section.transport {
    border-top: 4px solid var(--red-500);
}

.category-section.energy {
    border-top: 4px solid var(--amber-500);
}

.category-section.food {
    border-top: 4px solid var(--emerald-500);
}

.category-section.digital {
    border-top: 4px solid var(--purple-500);
}

.category-header {
    text-align: center;
    margin-bottom: var(--space-6);
}

.category-icon {
    font-size: 2.5rem;
    margin-bottom: var(--space-3);
}

.category-header h3 {
    font-size: 1.375rem;
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: var(--space-2);
}

.category-header p {
    color: var(--gray-600);
    font-size: 0.875rem;
}

.category-tips {
    list-style: none;
    padding: 0;
}

.category-tips li {
    padding: var(--space-3);
    margin-bottom: var(--space-2);
    background: var(--gray-50);
    border-radius: var(--radius-md);
    color: var(--gray-700);
    font-size: 0.875rem;
    line-height: 1.5;
    position: relative;
    padding-left: var(--space-8);
}

.category-tips li::before {
    content: '✓';
    position: absolute;
    left: var(--space-3);
    color: var(--emerald-500);
    font-weight: 700;
}

.progress-section {
    margin-bottom: var(--space-12);
}

.progress-card {
    background: linear-gradient(135deg, var(--emerald-500), var(--teal-500));
    color: white;
    border-radius: var(--radius-2xl);
    padding: var(--space-8);
    text-align: center;
    box-shadow: var(--shadow-lg);
}

.progress-card h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: var(--space-3);
}

.progress-card p {
    font-size: 1.125rem;
    margin-bottom: var(--space-8);
    opacity: 0.9;
}

.journey-stats {
    display: flex;
    justify-content: center;
    gap: var(--space-8);
    margin-bottom: var(--space-8);
    flex-wrap: wrap;
}

.journey-stat {
    display: flex;
    align-items: center;
    gap: var(--space-3);
}

.stat-icon {
    font-size: 1.5rem;
}

.stat-info strong {
    display: block;
    font-weight: 600;
}

.stat-info small {
    opacity: 0.8;
    font-size: 0.875rem;
}

.motivational-quote {
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-xl);
    padding: var(--space-6);
    margin-top: var(--space-6);
}

.motivational-quote blockquote {
    font-style: italic;
    font-size: 1.125rem;
    margin: 0;
}

.motivational-quote cite {
    display: block;
    margin-top: var(--space-2);
    font-size: 0.875rem;
    opacity: 0.8;
}

.cta-section {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-2xl);
    padding: var(--space-12);
    text-align: center;
    box-shadow: var(--shadow-lg);
}

.cta-content h2 {
    font-size: 2rem;
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: var(--space-4);
}

.cta-content p {
    font-size: 1.125rem;
    color: var(--gray-600);
    margin-bottom: var(--space-8);
}

.cta-actions {
    display: flex;
    gap: var(--space-4);
    justify-content: center;
    flex-wrap: wrap;
}

@media (max-width: 768px) {
    .tips-grid {
        grid-template-columns: 1fr;
    }

    .categories-grid {
        grid-template-columns: 1fr;
    }

    .journey-stats {
        flex-direction: column;
        gap: var(--space-4);
    }

    .cta-actions {
        flex-direction: column;
        align-items: center;
    }

    .cta-actions .btn {
        width: 100%;
        max-width: 300px;
    }
}
</style>
{% endblock %}
