{% extends 'base.html' %}

{% block title %}Login - GreenSteps{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <div class="auth-icon">üå±</div>
            <h1>Welcome Back!</h1>
            <p>Continue your sustainable journey with GreenSteps</p>
        </div>

        <form method="post" class="auth-form">
            {% csrf_token %}

            {% if form.errors %}
                <div class="form-errors">
                    {% for field, errors in form.errors.items %}
                        {% for error in errors %}
                            <div class="error-message">
                                <span class="error-icon">‚ö†Ô∏è</span>
                                {{ error }}
                            </div>
                        {% endfor %}
                    {% endfor %}
                </div>
            {% endif %}

            <div class="form-group">
                <label for="{{ form.username.id_for_label }}" class="form-label">
                    Username
                </label>
                <input
                    type="text"
                    name="username"
                    id="{{ form.username.id_for_label }}"
                    class="form-input {% if form.username.errors %}error{% endif %}"
                    placeholder="Enter your username"
                    value="{{ form.username.value|default:'' }}"
                    required
                >
            </div>

            <div class="form-group">
                <label for="{{ form.password.id_for_label }}" class="form-label">
                    Password
                </label>
                <div class="password-input-wrapper">
                    <input
                        type="password"
                        name="password"
                        id="{{ form.password.id_for_label }}"
                        class="form-input {% if form.password.errors %}error{% endif %}"
                        placeholder="Enter your password"
                        required
                    >
                    <button type="button" class="password-toggle" onclick="togglePassword()">
                        <span id="password-toggle-icon">üëÅÔ∏è</span>
                    </button>
                </div>
            </div>

            <div class="form-options">
                <label class="checkbox-label">
                    <input type="checkbox" name="remember_me" class="checkbox">
                    <span class="checkmark"></span>
                    Remember me
                </label>
                <a href="#" class="forgot-link">Forgot password?</a>
            </div>

            <button type="submit" class="btn btn-primary btn-lg auth-submit">
                <span class="btn-icon">üîë</span>
                Sign In
            </button>
        </form>

        <div class="auth-divider">
            <span>or</span>
        </div>

        <div class="auth-footer">
            <p>Don't have an account yet?</p>
            <a href="{% url 'register' %}" class="btn btn-secondary btn-lg">
                <span class="btn-icon">üå±</span>
                Create Account
            </a>
        </div>
    </div>

    <!-- Environmental Fact Sidebar -->
    <div class="fact-sidebar">
        <div class="fact-card">
            <div class="fact-icon">üåç</div>
            <h3>Did you know?</h3>
            <p id="environmental-fact">Loading environmental fact...</p>
        </div>

        <div class="stats-card">
            <h4>GreenSteps Community</h4>
            <div class="community-stats">
                <div class="stat-item">
                    <span class="stat-number" data-target="1250">0</span>
                    <span class="stat-label">Active Users</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" data-target="45680">0</span>
                    <span class="stat-label">Activities Tracked</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" data-target="892">0</span>
                    <span class="stat-label">Tons CO‚ÇÇ Saved</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function togglePassword() {
    const passwordInput = document.getElementById('{{ form.password.id_for_label }}');
    const toggleIcon = document.getElementById('password-toggle-icon');

    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.textContent = 'üôà';
    } else {
        passwordInput.type = 'password';
        toggleIcon.textContent = 'üëÅÔ∏è';
    }
}

// Environmental facts
const environmentalFacts = [
    "The average person in developed countries produces about 16 tons of CO‚ÇÇ per year.",
    "Taking public transport instead of driving can reduce your carbon footprint by up to 2.6 tons per year.",
    "Eating less meat just one day per week can save 1,900 pounds of CO‚ÇÇ annually.",
    "LED light bulbs use 75% less energy than traditional incandescent bulbs.",
    "A single tree can absorb 48 pounds of CO‚ÇÇ per year.",
    "Recycling one aluminum can saves enough energy to run a TV for 3 hours.",
    "Digital activities account for about 4% of global greenhouse gas emissions.",
    "Walking or biking for short trips can eliminate 2.4 billion pounds of CO‚ÇÇ annually."
];

// Animate community stats
function animateStats() {
    const statNumbers = document.querySelectorAll('.stat-number');

    statNumbers.forEach(stat => {
        const target = parseInt(stat.dataset.target);
        const duration = 2000;
        const increment = target / (duration / 16);
        let current = 0;

        const timer = setInterval(() => {
            current += increment;
            if (current >= target) {
                stat.textContent = target.toLocaleString();
                clearInterval(timer);
            } else {
                stat.textContent = Math.floor(current).toLocaleString();
            }
        }, 16);
    });
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    // Show random environmental fact
    const randomFact = environmentalFacts[Math.floor(Math.random() * environmentalFacts.length)];
    document.getElementById('environmental-fact').textContent = randomFact;

    // Start stats animation when visible
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                animateStats();
                observer.disconnect();
            }
        });
    });

    const statsCard = document.querySelector('.stats-card');
    if (statsCard) {
        observer.observe(statsCard);
    }

    // Focus first input
    const firstInput = document.querySelector('.form-input');
    if (firstInput) {
        firstInput.focus();
    }
});
</script>

<style>
.auth-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-12);
    max-width: 1000px;
    margin: 0 auto;
    padding: var(--space-8);
    min-height: 80vh;
    align-items: center;
}

.auth-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-2xl);
    padding: var(--space-12);
    box-shadow: var(--shadow-xl);
    animation: slideInLeft 0.6s ease-out;
}

.auth-header {
    text-align: center;
    margin-bottom: var(--space-8);
}

.auth-icon {
    font-size: 3rem;
    margin-bottom: var(--space-4);
    animation: gentle-bounce 2s ease-in-out infinite;
}

.auth-header h1 {
    font-size: 2rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: var(--space-3);
}

.auth-header p {
    color: var(--gray-600);
    font-size: 1.125rem;
}

.auth-form {
    margin-bottom: var(--space-8);
}

.form-errors {
    margin-bottom: var(--space-6);
}

.error-message {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3);
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.2);
    border-radius: var(--radius-md);
    color: var(--red-600);
    font-size: 0.875rem;
    margin-bottom: var(--space-2);
}

.form-group {
    margin-bottom: var(--space-6);
}

.form-label {
    display: block;
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: var(--space-2);
    font-size: 0.875rem;
}

.form-input {
    width: 100%;
    padding: var(--space-4);
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-lg);
    font-size: 1rem;
    background: rgba(255, 255, 255, 0.9);
    transition: all 0.2s ease;
}

.form-input:focus {
    outline: none;
    border-color: var(--emerald-500);
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

.form-input.error {
    border-color: var(--red-500);
}

.password-input-wrapper {
    position: relative;
}

.password-toggle {
    position: absolute;
    right: var(--space-4);
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.25rem;
    opacity: 0.7;
    transition: opacity 0.2s ease;
}

.password-toggle:hover {
    opacity: 1;
}

.form-options {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-8);
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    cursor: pointer;
    color: var(--gray-600);
    font-size: 0.875rem;
}

.checkbox {
    width: 16px;
    height: 16px;
}

.forgot-link {
    color: var(--emerald-600);
    text-decoration: none;
    font-size: 0.875rem;
    transition: color 0.2s ease;
}

.forgot-link:hover {
    color: var(--emerald-700);
    text-decoration: underline;
}

.auth-submit {
    width: 100%;
    margin-bottom: var(--space-6);
}

.auth-divider {
    text-align: center;
    position: relative;
    margin: var(--space-8) 0;
    color: var(--gray-500);
}

.auth-divider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: var(--gray-200);
    z-index: -1;
}

.auth-divider span {
    background: rgba(255, 255, 255, 0.95);
    padding: 0 var(--space-4);
}

.auth-footer {
    text-align: center;
}

.auth-footer p {
    color: var(--gray-600);
    margin-bottom: var(--space-4);
}

.auth-footer .btn {
    width: 100%;
}

.fact-sidebar {
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
    animation: slideInRight 0.6s ease-out;
}

.fact-card, .stats-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-2xl);
    padding: var(--space-8);
    box-shadow: var(--shadow-lg);
    transition: transform 0.3s ease;
}

.fact-card:hover, .stats-card:hover {
    transform: translateY(-5px);
}

.fact-icon {
    font-size: 2.5rem;
    text-align: center;
    margin-bottom: var(--space-4);
}

.fact-card h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: var(--space-3);
    text-align: center;
}

.fact-card p {
    color: var(--gray-600);
    line-height: 1.6;
    font-style: italic;
    text-align: center;
}

.stats-card h4 {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: var(--space-6);
    text-align: center;
}

.community-stats {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
}

.stat-item {
    text-align: center;
    padding: var(--space-3);
    background: var(--emerald-50);
    border-radius: var(--radius-lg);
    border: 1px solid var(--emerald-100);
}

.stat-number {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--emerald-600);
    margin-bottom: var(--space-1);
}

.stat-label {
    font-size: 0.75rem;
    color: var(--gray-600);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 500;
}

/* Animations */
@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* Responsive Design */
@media (max-width: 1024px) {
    .auth-container {
        grid-template-columns: 1fr;
        gap: var(--space-8);
    }

    .fact-sidebar {
        order: -1;
    }

    .fact-sidebar .community-stats {
        flex-direction: row;
        justify-content: space-around;
    }

    .stat-item {
        flex: 1;
        margin: 0 var(--space-2);
    }
}

@media (max-width: 768px) {
    .auth-container {
        padding: var(--space-4);
    }

    .auth-card {
        padding: var(--space-8);
    }

    .fact-card, .stats-card {
        padding: var(--space-6);
    }

    .form-options {
        flex-direction: column;
        gap: var(--space-3);
        align-items: flex-start;
    }

    .community-stats {
        flex-direction: column;
    }
}
</style>
{% endblock %}
